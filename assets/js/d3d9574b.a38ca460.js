"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[9575],{4683:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>t,default:()=>f,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var i=s(4848),o=s(8453);const r={description:"Diffing ntoskrnl.exe - KB5022913 - 11-22H2 - CVE-2023-2342"},t=void 0,a={id:"guides/Diffing the Windows Kernel",title:"Diffing the Windows Kernel",description:"Diffing ntoskrnl.exe - KB5022913 - 11-22H2 - CVE-2023-2342",source:"@site/docs/guides/Diffing the Windows Kernel.md",sourceDirName:"guides",slug:"/guides/Diffing the Windows Kernel",permalink:"/ghidriff/docs/guides/Diffing the Windows Kernel",draft:!1,unlisted:!1,editUrl:"https://github.com/clearbluejar/ghidriff/tree/main/www/docs/docs/guides/Diffing the Windows Kernel.md",tags:[],version:"current",frontMatter:{description:"Diffing ntoskrnl.exe - KB5022913 - 11-22H2 - CVE-2023-2342"},sidebar:"tutorialSidebar",previous:{title:"Diffing an iOS dylib - CVE-2024-23218",permalink:"/ghidriff/docs/guides/Diffing an iOS dylib - CVE-2024-23218"},next:{title:"Binary-Similarity-BSIM",permalink:"/ghidriff/docs/BSIM/Binary-Similarity-BSIM"}},l={},c=[{value:"Diffing a Windows Kernel",id:"diffing-a-windows-kernel",level:3},{value:"Download two versions of the kernel (older and latest binary):",id:"download-two-versions-of-the-kernel-older-and-latest-binary",level:4},{value:"Run ghidriff:",id:"run-ghidriff",level:4},{value:"Analyze the Diff",id:"analyze-the-diff",level:4},{value:"Results stored in <code>ghidriffs</code> folder",id:"results-stored-in-ghidriffs-folder",level:5}];function d(n){const e={a:"a",code:"code",details:"details",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",summary:"summary",ul:"ul",...(0,o.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h3,{id:"diffing-a-windows-kernel",children:"Diffing a Windows Kernel"}),"\n",(0,i.jsx)(e.h4,{id:"download-two-versions-of-the-kernel-older-and-latest-binary",children:"Download two versions of the kernel (older and latest binary):"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"wget https://msdl.microsoft.com/download/symbols/ntoskrnl.exe/F7E31BA91047000/ntoskrnl.exe -O ntoskrnl.exe.10.0.22621.1344\nwget https://msdl.microsoft.com/download/symbols/ntoskrnl.exe/17B6B7221047000/ntoskrnl.exe -O ntoskrnl.exe.10.0.22621.1413\n"})}),"\n",(0,i.jsxs)(e.details,{children:[(0,i.jsx)(e.summary,{children:"Console Output:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-console",children:"vscode \u279c /workspaces/ghidriff (main) $ wget https://msdl.microsoft.com/download/symbols/ntoskrnl.exe/F7E31BA91047000/ntoskrnl.exe -O ntoskrnl.exe.10.0.22621.1344\n--2023-05-17 03:18:40--  https://msdl.microsoft.com/download/symbols/ntoskrnl.exe/F7E31BA91047000/ntoskrnl.exe\nResolving msdl.microsoft.com (msdl.microsoft.com)... 204.79.197.219\nConnecting to msdl.microsoft.com (msdl.microsoft.com)|204.79.197.219|:443... connected.\nHTTP request sent, awaiting response... 302 Found\nCould not parse String-Transport-Security header\nLocation: https://vsblobprodscussu5shard72.blob.core.windows.net/b-4712e0edc5a240eabf23330d7df68e77/8BFC691F50434EC2DC87BBDFC06A6A5FBACE992E60062F9C8CE829F58E3BCFB300.blob?sv=2019-07-07&sr=b&si=1&sig=Kgrvf90Kc15ac%2FtHsgPPj9ztxxTfkQ0yHGQh8dLDwQs%3D&spr=https&se=2023-05-18T03%3A32%3A47Z&rscl=x-e2eid-420cea82-598a4a00-a990abf8-919be2ff-session-5e9eb5eb-195146cb-b123c222-30eef52e [following]\n--2023-05-17 03:18:40--  https://vsblobprodscussu5shard72.blob.core.windows.net/b-4712e0edc5a240eabf23330d7df68e77/8BFC691F50434EC2DC87BBDFC06A6A5FBACE992E60062F9C8CE829F58E3BCFB300.blob?sv=2019-07-07&sr=b&si=1&sig=Kgrvf90Kc15ac%2FtHsgPPj9ztxxTfkQ0yHGQh8dLDwQs%3D&spr=https&se=2023-05-18T03%3A32%3A47Z&rscl=x-e2eid-420cea82-598a4a00-a990abf8-919be2ff-session-5e9eb5eb-195146cb-b123c222-30eef52e\nResolving vsblobprodscussu5shard72.blob.core.windows.net (vsblobprodscussu5shard72.blob.core.windows.net)... 20.209.34.36\nConnecting to vsblobprodscussu5shard72.blob.core.windows.net (vsblobprodscussu5shard72.blob.core.windows.net)|20.209.34.36|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 11990400 (11M) [application/octet-stream]\nSaving to: \u2018ntoskrnl.exe.10.0.22621.1344\u2019\n\nntoskrnl.exe.10.0.22621.1344                       100%[===============================================================================================================>]  11.43M  2.47MB/s    in 5.5s    \n\n2023-05-17 03:18:46 (2.08 MB/s) - \u2018ntoskrnl.exe.10.0.22621.1344\u2019 saved [11990400/11990400]\n\nvscode \u279c /workspaces/ghidriff (main) $ wget https://msdl.microsoft.com/download/symbols/ntoskrnl.exe/17B6B7221047000/ntoskrnl.exe -O ntoskrnl.exe.10.0.22621.1413\n--2023-05-17 03:18:58--  https://msdl.microsoft.com/download/symbols/ntoskrnl.exe/17B6B7221047000/ntoskrnl.exe\nResolving msdl.microsoft.com (msdl.microsoft.com)... 204.79.197.219\nConnecting to msdl.microsoft.com (msdl.microsoft.com)|204.79.197.219|:443... connected.\nHTTP request sent, awaiting response... 302 Found\nCould not parse String-Transport-Security header\nLocation: https://vsblobprodscussu5shard75.blob.core.windows.net/b-4712e0edc5a240eabf23330d7df68e77/D946523F2726056CD289008C977D02C0C0FBBCBB89D9FA40ADBB42CDE8D5022A00.blob?sv=2019-07-07&sr=b&si=1&sig=KfYz9cB7cUPO9JVo0U8eIj0etpASEWOyvCv5NkwVkfw%3D&spr=https&se=2023-05-18T03%3A50%3A53Z&rscl=x-e2eid-4960dee3-47d94aa4-a2207913-b73825a4-session-2879fa10-75774ef4-93e39015-3be72abb [following]\n--2023-05-17 03:18:59--  https://vsblobprodscussu5shard75.blob.core.windows.net/b-4712e0edc5a240eabf23330d7df68e77/D946523F2726056CD289008C977D02C0C0FBBCBB89D9FA40ADBB42CDE8D5022A00.blob?sv=2019-07-07&sr=b&si=1&sig=KfYz9cB7cUPO9JVo0U8eIj0etpASEWOyvCv5NkwVkfw%3D&spr=https&se=2023-05-18T03%3A50%3A53Z&rscl=x-e2eid-4960dee3-47d94aa4-a2207913-b73825a4-session-2879fa10-75774ef4-93e39015-3be72abb\nResolving vsblobprodscussu5shard75.blob.core.windows.net (vsblobprodscussu5shard75.blob.core.windows.net)... 20.209.34.36\nConnecting to vsblobprodscussu5shard75.blob.core.windows.net (vsblobprodscussu5shard75.blob.core.windows.net)|20.209.34.36|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 11990336 (11M) [application/octet-stream]\nSaving to: \u2018ntoskrnl.exe.10.0.22621.1413\u2019\n\nntoskrnl.exe.10.0.22621.1413                       100%[===============================================================================================================>]  11.43M  1.02MB/s    in 12s     \n\n2023-05-17 03:19:11 (1004 KB/s) - \u2018ntoskrnl.exe.10.0.22621.1413\u2019 saved [11990336/11990336]\n"})}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"run-ghidriff",children:"Run ghidriff:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"ghidriff ntoskrnl.exe.10.0.22621.1344 ntoskrnl.exe.10.0.22621.1413\n"})}),"\n",(0,i.jsxs)(e.details,{children:[(0,i.jsx)(e.summary,{children:"Console Output"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-console",children:"(.env) vscode \u279c /workspaces/ghidriff (main) $ ghidriff ntoskrnl.exe.10.0.22621.1344 ntoskrnl.exe.10.0.22621.1413\nINFO | ghidriff | Init Ghidra Diff Engine...\nINFO | ghidriff | Engine Console Log: INFO\nINFO | ghidriff | Engine File Log:  .ghidriffs/ghidriff.log INFO\nINFO | ghidriff | Starting Ghidra...\nINFO  Using log config file: jar:file:/ghidra/Ghidra/Framework/Generic/lib/Generic.jar!/generic.log4j.xml (LoggingInitialization)  \nINFO  Using log file: /workspaces/ghidriff/.ghidriffs/ghidriff.log (LoggingInitialization)  \nINFO  Loading user preferences: /home/vscode/.ghidra/.ghidra_10.2.3_PUBLIC/preferences (Preferences)  \nINFO  Class search complete (716 ms) (ClassSearcher)  \nINFO  Initializing SSL Context (SSLContextInitializer)  \nINFO  Initializing Random Number Generator... (SecureRandomFactory)  \nINFO  Random Number Generator initialization complete: NativePRNGNonBlocking (SecureRandomFactory)  \nINFO  Trust manager disabled, cacerts have not been set (ApplicationTrustManagerFactory)  \nINFO | ghidriff | GHIDRA_INSTALL_DIR: /ghidra\nINFO | ghidriff | GHIDRA 10.2.3  Build Date: 2023-Feb-08 1242 EST Release: PUBLIC\nINFO | ghidriff | Engine Args:\nINFO | ghidriff |       old:                ['ntoskrnl.exe.10.0.22621.1344']\nINFO | ghidriff |       new:                [['ntoskrnl.exe.10.0.22621.1413']]\nINFO | ghidriff |       engine:             VersionTrackingDiff\nINFO | ghidriff |       output_path:        .ghidriffs\nINFO | ghidriff |       summary:            False\nINFO | ghidriff |       project_location:   .ghidra_projects\nINFO | ghidriff |       project_name:       ghidriff\nINFO | ghidriff |       symbols_path:       .symbols\nINFO | ghidriff |       threaded:           True\nINFO | ghidriff |       force_analysis:     False\nINFO | ghidriff |       force_diff:         False\nINFO | ghidriff |       no_symbols:         False\nINFO | ghidriff |       log_level:          INFO\nINFO | ghidriff |       file_log_level:     INFO\nINFO | ghidriff |       log_path:           ghidriff.log\nINFO | ghidriff |       va:                 False\nINFO | ghidriff |       max_ram_percent:    60.0\nINFO | ghidriff |       print_flags:        False\nINFO | ghidriff |       jvm_args:           None\nINFO | ghidriff |       side_by_side:       False\nINFO | ghidriff |       max_section_funcs:  200\nINFO | ghidriff |       md_title:           None\nINFO | ghidriff | Setting Up Ghidra Project...\nINFO  Creating project: /workspaces/ghidriff/.ghidra_projects/ghidriff-ntoskrnl.exe.10.0.22621.1344-ntoskrnl.exe.10.0.22621.1413/ghidriff-ntoskrnl.exe.10.0.22621.1344-ntoskrnl.exe.10.0.22621.1413 (DefaultProject)  \nINFO | ghidriff | Created project: ghidriff-ntoskrnl.exe.10.0.22621.1344-ntoskrnl.exe.10.0.22621.1413\nINFO | ghidriff | Project Location: /workspaces/ghidriff/.ghidra_projects/ghidriff-ntoskrnl.exe.10.0.22621.1344-ntoskrnl.exe.10.0.22621.1413\nINFO | ghidriff | Importing ntoskrnl.exe.10.0.22621.1344\nINFO  Starting cache cleanup: /tmp/vscode-Ghidra/fscache2 (FileCacheMaintenanceDaemon)  \nINFO  Finished cache cleanup, estimated storage used: 0 (FileCacheMaintenanceDaemon)  \nINFO  Using Loader: Portable Executable (PE) (AutoImporter)  \nINFO | ghidriff | Importing ntoskrnl.exe.10.0.22621.1413\nINFO  Using Loader: Portable Executable (PE) (AutoImporter)  \nINFO | ghidriff | Setting up Symbol Server for symbols...\nINFO | ghidriff | path: .symbols level: 1\nINFO | ghidriff | Symbol Server Configured path: SymbolServerService:\n        symbolStore: LocalSymbolStore: [ rootDir: /workspaces/ghidriff/.symbols, storageLevel: -1],\n        symbolServers:\n                HttpSymbolServer: [ url: https://msdl.microsoft.com/download/symbols/, storageLevel: -1]\n                HttpSymbolServer: [ url: https://chromium-browser-symsrv.commondatastorage.googleapis.com/, storageLevel: -1]\n                HttpSymbolServer: [ url: https://symbols.mozilla.org/, storageLevel: -1]\n                HttpSymbolServer: [ url: https://software.intel.com/sites/downloads/symbols/, storageLevel: -1]\n                HttpSymbolServer: [ url: https://driver-symbols.nvidia.com/, storageLevel: -1]\n                HttpSymbolServer: [ url: https://download.amd.com/dir/bin/, storageLevel: -1]\nINFO  Connecting to https://msdl.microsoft.com/download/symbols/ (ConsoleTaskMonitor)  \nINFO  Success (ConsoleTaskMonitor)  \nINFO  Storing ntkrnlmp.pdb in local symbol store (12.66MB) (ConsoleTaskMonitor)  \nINFO | ghidriff | Pdb stored at: /workspaces/ghidriff/.symbols/ntkrnlmp.pdb/FB0913AF0585F234BD64A64A87C62DB11/ntkrnlmp.pdb\nINFO  Connecting to https://msdl.microsoft.com/download/symbols/ (ConsoleTaskMonitor)  \nINFO  Success (ConsoleTaskMonitor)  \nINFO  Storing ntkrnlmp.pdb in local symbol store (12.66MB) (ConsoleTaskMonitor)  \nINFO | ghidriff | Pdb stored at: /workspaces/ghidriff/.symbols/ntkrnlmp.pdb/797E613DB16DB6C0E57795A0CB03F4711/ntkrnlmp.pdb\nINFO | ghidriff | Program: /ntoskrnl.exe.10.0.22621.1344 imported: True has_pdb: True pdb_loaded: False analyzed False\nINFO | ghidriff | Program: /ntoskrnl.exe.10.0.22621.1413 imported: True has_pdb: True pdb_loaded: False analyzed False\nINFO | ghidriff | Starting analysis for 2 binaries\nINFO | ghidriff | Analyzing: ntoskrnl.exe.10.0.22621.1413 - .ProgramDB\nINFO | ghidriff | Analyzing: ntoskrnl.exe.10.0.22621.1344 - .ProgramDB\nWARNING| ghidriff | Turning off 'Shared Return Calls' for ntoskrnl.exe.10.0.22621.1344 - .ProgramDB\nINFO | ghidriff | Starting Ghidra analysis of ntoskrnl.exe.10.0.22621.1344 - .ProgramDB...\nINFO  PDB analyzer parsing file: /workspaces/ghidriff/.symbols/ntkrnlmp.pdb/FB0913AF0585F234BD64A64A87C62DB11/ntkrnlmp.pdb (PdbUniversalAnalyzer)  \nWARNING| ghidriff | Turning off 'Shared Return Calls' for ntoskrnl.exe.10.0.22621.1413 - .ProgramDB\nINFO | ghidriff | Starting Ghidra analysis of ntoskrnl.exe.10.0.22621.1413 - .ProgramDB...\nINFO  PDB analyzer parsing file: /workspaces/ghidriff/.symbols/ntkrnlmp.pdb/797E613DB16DB6C0E57795A0CB03F4711/ntkrnlmp.pdb (PdbUniversalAnalyzer)  \nWARN  PDB STRUCTURE reconstruction failed to align /ntkrnlmp.pdb/<unnamed-tag_00001117> (CppCompositeType)  \nWARN  PDB STRUCTURE reconstruction failed to align /ntkrnlmp.pdb/<unnamed-tag_0000111B> (CppCompositeType)  \nWARN  PDB STRUCTURE reconstruction failed to align /ntkrnlmp.pdb/<unnamed-tag_0000111F> (CppCompositeType)  \nWARN  PDB STRUCTURE reconstruction failed to align /ntkrnlmp.pdb/_WMI_LOGGER_CONTEXT (CppCompositeType)  \nWARN  PDB STRUCTURE reconstruction failed to align /ntkrnlmp.pdb/_PPM_PLATFORM_STATE (CppCompositeType)  \nWARN  PDB STRUCTURE reconstruction failed to align /ntkrnlmp.pdb/_IOP_IRP_EXTENSION (CppCompositeType)  \nWARN  PDB STRUCTURE reconstruction failed to align /ntkrnlmp.pdb/_EX_HEAP_POOL_NODE (CppCompositeType)  \nWARN  PDB STRUCTURE reconstruction failed to align /ntkrnlmp.pdb/_BLOB (CppCompositeType)  \nWARN  PDB STRUCTURE reconstruction failed to align /ntkrnlmp.pdb/_MMPAGING_FILE (CppCompositeType)  \nWARN  PDB STRUCTURE reconstruction failed to align /ntkrnlmp.pdb/_MMCLONE_DESCRIPTOR (CppCompositeType)  \nWARN  PDB STRUCTURE reconstruction failed to align /ntkrnlmp.pdb/_KUSER_SHARED_DATA (CppCompositeType)  \nINFO  Resolve time: 1939 mS (DefaultPdbApplicator)  \nINFO  resolveCount: 3644 (DefaultPdbApplicator)  \nINFO  Resolve time: 1854 mS (DefaultPdbApplicator)  \nINFO  resolveCount: 3644 (DefaultPdbApplicator)  \nWARN  Decompiling 1402efc70, pcode error at 14000000c: Unable to resolve constructor at 14000000c (DecompileCallback)  \nWARN  Decompiling 1402efc70, pcode error at 14000000c: Unable to resolve constructor at 14000000c (DecompileCallback)  \nWARN  Decompiling 1402efc70, pcode error at 14000000c: Unable to resolve constructor at 14000000c (DecompileCallback)  \nINFO  Packed database cache: /tmp/vscode-Ghidra/packed-db-cache (PackedDatabaseCache)  \n\n \nINFO  -----------------------------------------------------\n    ASCII Strings                              0.137 secs\n    Apply Data Archives                        3.295 secs\n    Call Convention ID                         2.037 secs\n    Call-Fixup Installer                       0.998 secs\n    Create Address Tables                      0.021 secs\n    Create Address Tables - One Time           5.159 secs\n    Create Function                            8.858 secs\n    Data Reference                            17.246 secs\n    Decompiler Switch Analysis               266.328 secs\n    Demangler Microsoft                        3.514 secs\n    Disassemble                                0.232 secs\n    Disassemble Entry Points                  58.448 secs\n    Disassemble Entry Points - One Time        1.802 secs\n    Embedded Media                             0.123 secs\n    External Entry References                  0.125 secs\n    Function ID                              114.335 secs\n    Function Start Search                      0.859 secs\n    Non-Returning Functions - Discovered      25.594 secs\n    Non-Returning Functions - Known            0.144 secs\n    PDB Universal                            168.601 secs\n    Reference                                  6.969 secs\n    Scalar Operand References                 91.615 secs\n    Shared Return Calls                        4.718 secs\n    Stack                                    291.121 secs\n    Subroutine References                     14.672 secs\n    Subroutine References - One Time           0.027 secs\n    Windows x86 PE Exception Handling          0.470 secs\n    Windows x86 PE RTTI Analyzer               0.091 secs\n    Windows x86 Thread Environment Block (TEB) Analyzer     0.115 secs\n    WindowsResourceReference                   0.413 secs\n    x86 Constant Reference Analyzer          261.728 secs\n-----------------------------------------------------\n     Total Time   1349 secs\n-----------------------------------------------------\n (AutoAnalysisManager)  \nINFO  -----------------------------------------------------\n    ASCII Strings                              3.249 secs\n    Apply Data Archives                        3.290 secs\n    Call Convention ID                         1.984 secs\n    Call-Fixup Installer                       0.947 secs\n    Create Address Tables                      0.007 secs\n    Create Address Tables - One Time           5.178 secs\n    Create Function                            8.855 secs\n    Data Reference                            17.320 secs\n    Decompiler Switch Analysis               264.962 secs\n    Demangler Microsoft                        3.649 secs\n    Disassemble                                0.468 secs\n    Disassemble Entry Points                  58.480 secs\n    Disassemble Entry Points - One Time        1.805 secs\n    Embedded Media                             0.102 secs\n    External Entry References                  0.120 secs\n    Function ID                              114.285 secs\n    Function Start Search                      0.987 secs\n    Non-Returning Functions - Discovered      25.826 secs\n    Non-Returning Functions - Known            0.034 secs\n    PDB Universal                            169.189 secs\n    Reference                                  6.714 secs\n    Scalar Operand References                 91.422 secs\n    Shared Return Calls                        4.760 secs\n    Stack                                    291.137 secs\n    Subroutine References                     14.711 secs\n    Subroutine References - One Time           0.018 secs\n    Windows x86 PE Exception Handling          0.463 secs\n    Windows x86 PE RTTI Analyzer               0.089 secs\n    Windows x86 Thread Environment Block (TEB) Analyzer     0.119 secs\n    WindowsResourceReference                   0.403 secs\n    x86 Constant Reference Analyzer          262.810 secs\n-----------------------------------------------------\n     Total Time   1353 secs\n-----------------------------------------------------\n (AutoAnalysisManager)  \nINFO | ghidriff | Analysis for ghidriff-ntoskrnl.exe.10.0.22621.1344-ntoskrnl.exe.10.0.22621.1413:/ntoskrnl.exe.10.0.22621.1413 complete\nINFO | ghidriff | Analysis for ghidriff-ntoskrnl.exe.10.0.22621.1344-ntoskrnl.exe.10.0.22621.1413:/ntoskrnl.exe.10.0.22621.1344 complete\nINFO | ghidriff | Diffing bins: ntoskrnl.exe.10.0.22621.1344 - ntoskrnl.exe.10.0.22621.1413\nINFO | ghidriff | Setup 16 decompliers\nINFO | ghidriff | Loaded old program: ntoskrnl.exe.10.0.22621.1344\nINFO | ghidriff | Loaded new program: ntoskrnl.exe.10.0.22621.1413\nINFO | ghidriff | p1 sym count: reported: 244603 analyzed: 16772\nINFO | ghidriff | p2 sym count: reported: 244606 analyzed: 16809\nINFO | ghidriff | Found unmatched: 65 matched: 16758 symbols\nINFO  Hashing symbols in ntoskrnl.exe.10.0.22621.1344 (ConsoleTaskMonitor)  \nINFO  Hashing symbols in ntoskrnl.exe.10.0.22621.1413 (ConsoleTaskMonitor)  \nINFO  Eliminate non-unique matches (ConsoleTaskMonitor)  \nINFO  Finding symbol matches (ConsoleTaskMonitor)  \nINFO | ghidriff | Exec time: 2.1672 secs\nINFO | ghidriff | Match count 54939\nINFO | ghidriff | Counter({('SymbolsHash',): 27893})\nINFO | ghidriff | Running correlator: ExactBytesFunctionHasher\nINFO | ghidriff | name: ExactBytesFunctionHasher hasher: ghidra.app.plugin.match.ExactBytesFunctionHasher@7167d81b one_to_one: True one_to_many: False\nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1344 (ConsoleTaskMonitor)  \nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1413 (ConsoleTaskMonitor)  \nINFO  Finding function matches (ConsoleTaskMonitor)  \nINFO | ghidriff | ExactBytesFunctionHasher Exec time: 0.8299 secs\nINFO | ghidriff | Match count: 100\nINFO | ghidriff | Counter({('SymbolsHash',): 27893, ('ExactBytesFunctionHasher',): 100})\nINFO | ghidriff | Running correlator: ExactInstructionsFunctionHasher\nINFO | ghidriff | name: ExactInstructionsFunctionHasher hasher: ghidra.app.plugin.match.ExactInstructionsFunctionHasher@3c9cfcde one_to_one: True one_to_many: False\nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1344 (ConsoleTaskMonitor)  \nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1413 (ConsoleTaskMonitor)  \nINFO  Finding function matches (ConsoleTaskMonitor)  \nINFO | ghidriff | ExactInstructionsFunctionHasher Exec time: 0.4906 secs\nINFO | ghidriff | Match count: 123\nINFO | ghidriff | Counter({('SymbolsHash',): 27893, ('ExactInstructionsFunctionHasher',): 123, ('ExactBytesFunctionHasher',): 100})\nINFO | ghidriff | Running correlator: StructuralGraphExactHash\nINFO | ghidriff | name: StructuralGraphExactHash hasher: <jpype._jproxy.proxy.StructuralGraphExactHasher object at 0xffff26c53bf0> one_to_one: True one_to_many: False\nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1344 (ConsoleTaskMonitor)  \nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1413 (ConsoleTaskMonitor)  \nINFO  Finding function matches (ConsoleTaskMonitor)  \nINFO | ghidriff | StructuralGraphExactHash Exec time: 1.3213 secs\nINFO | ghidriff | Match count: 0\nINFO | ghidriff | Counter({('SymbolsHash',): 27893, ('ExactInstructionsFunctionHasher',): 123, ('ExactBytesFunctionHasher',): 100})\nINFO | ghidriff | Running correlator: ExactMnemonicsFunctionHasher\nINFO | ghidriff | name: ExactMnemonicsFunctionHasher hasher: ghidra.app.plugin.match.ExactMnemonicsFunctionHasher@7533923b one_to_one: True one_to_many: False\nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1344 (ConsoleTaskMonitor)  \nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1413 (ConsoleTaskMonitor)  \nINFO  Finding function matches (ConsoleTaskMonitor)  \nINFO | ghidriff | ExactMnemonicsFunctionHasher Exec time: 2.5697 secs\nINFO | ghidriff | Match count: 0\nINFO | ghidriff | Counter({('SymbolsHash',): 27893, ('ExactInstructionsFunctionHasher',): 123, ('ExactBytesFunctionHasher',): 100})\nINFO | ghidriff | Running correlator: BulkInstructionHash\nINFO | ghidriff | name: BulkInstructionHash hasher: <jpype._jproxy.proxy.BulkInstructionsHasher object at 0xffff26c53b50> one_to_one: True one_to_many: False\nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1344 (ConsoleTaskMonitor)  \nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1413 (ConsoleTaskMonitor)  \nINFO  Finding function matches (ConsoleTaskMonitor)  \nINFO | ghidriff | BulkInstructionHash Exec time: 1.1462 secs\nINFO | ghidriff | Match count: 2\nINFO | ghidriff | Counter({('SymbolsHash',): 27893, ('ExactInstructionsFunctionHasher',): 123, ('ExactBytesFunctionHasher',): 100, ('BulkInstructionHash',): 2})\nINFO | ghidriff | Running correlator: StructuralGraphHash\nINFO | ghidriff | name: StructuralGraphHash hasher: <jpype._jproxy.proxy.StructuralGraphHasher object at 0xffff26c53ab0> one_to_one: True one_to_many: True\nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1344 (ConsoleTaskMonitor)  \nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1413 (ConsoleTaskMonitor)  \nINFO  Finding function matches (ConsoleTaskMonitor)  \nINFO | ghidriff | StructuralGraphHash Exec time: 0.1894 secs\nINFO | ghidriff | Match count: 693\nINFO | ghidriff | Counter({('SymbolsHash',): 27893, ('StructuralGraphHash',): 693, ('ExactInstructionsFunctionHasher',): 123, ('ExactBytesFunctionHasher',): 100, ('BulkInstructionHash',): 2})\nINFO | ghidriff | Running correlator: BulkBasicBlockMnemonicHash\nINFO | ghidriff | name: BulkBasicBlockMnemonicHash hasher: <jpype._jproxy.proxy.BulkBasicBlockMnemonicHasher object at 0xffff26c53a10> one_to_one: True one_to_many: True\nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1344 (ConsoleTaskMonitor)  \nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1413 (ConsoleTaskMonitor)  \nINFO  Finding function matches (ConsoleTaskMonitor)  \nINFO | ghidriff | BulkBasicBlockMnemonicHash Exec time: 0.1846 secs\nINFO | ghidriff | Match count: 0\nINFO | ghidriff | Counter({('SymbolsHash',): 27893, ('StructuralGraphHash',): 693, ('ExactInstructionsFunctionHasher',): 123, ('ExactBytesFunctionHasher',): 100, ('BulkInstructionHash',): 2})\nINFO | ghidriff | Running correlator: SigCallingCalledHasher\nINFO | ghidriff | name: SigCallingCalledHasher hasher: <jpype._jproxy.proxy.SigCallingCalledHasher object at 0xffff26c53970> one_to_one: True one_to_many: False\nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1344 (ConsoleTaskMonitor)  \nINFO  Hashing functions in ntoskrnl.exe.10.0.22621.1413 (ConsoleTaskMonitor)  \nINFO  Finding function matches (ConsoleTaskMonitor)  \nINFO | ghidriff | SigCallingCalledHasher Exec time: 0.1398 secs\nINFO | ghidriff | Match count: 0\nINFO | ghidriff | Counter({('SymbolsHash',): 27893, ('StructuralGraphHash',): 693, ('ExactInstructionsFunctionHasher',): 123, ('ExactBytesFunctionHasher',): 100, ('BulkInstructionHash',): 2})\nINFO | ghidriff | p1 missing = 1\nINFO | ghidriff | p2 missing = 1\nINFO | ghidriff | Deduping symbols and functions...\nINFO | ghidriff | Sorting symbols and strings...\nINFO | ghidriff | Sorting functions...\nINFO | ghidriff | Starting esym lookups for 71 symbols using 8 threads\nINFO | ghidriff | Completed 4 at 5%\nINFO | ghidriff | Completed 8 at 11%\nINFO | ghidriff | Completed 12 at 16%\nINFO | ghidriff | Completed 16 at 22%\nINFO | ghidriff | Completed 20 at 28%\nINFO | ghidriff | Completed 24 at 33%\nINFO | ghidriff | Completed 28 at 39%\nINFO | ghidriff | Completed 32 at 45%\nINFO | ghidriff | Completed 36 at 50%\nINFO | ghidriff | Completed 40 at 56%\nINFO | ghidriff | Completed 44 at 61%\nINFO | ghidriff | Completed 48 at 67%\nINFO | ghidriff | Completed 52 at 73%\nINFO | ghidriff | Completed 56 at 78%\nINFO | ghidriff | Completed 60 at 84%\nINFO | ghidriff | Completed 64 at 90%\nINFO | ghidriff | Completed 68 at 95%\nINFO | ghidriff | Finished diffing old program: ntoskrnl.exe.10.0.22621.1344\nINFO | ghidriff | Finished diffing program: ntoskrnl.exe.10.0.22621.1413\nINFO | ghidriff | {\n  \"added_funcs_len\": 1,\n  \"deleted_funcs_len\": 1,\n  \"modified_funcs_len\": 11,\n  \"added_symbols_len\": 12,\n  \"deleted_symbols_len\": 8,\n  \"diff_time\": 86.45361375808716,\n  \"deleted_strings_len\": 6,\n  \"added_strings_len\": 39,\n  \"match_types\": {\n    \"SymbolsHash\": 27893,\n    \"ExactBytesFunctionHasher\": 100,\n    \"ExactInstructionsFunctionHasher\": 123,\n    \"BulkInstructionHash\": 2,\n    \"StructuralGraphHash\": 693\n  },\n  \"items_to_process\": 33,\n  \"diff_types\": {\n    \"code\": 5,\n    \"length\": 5,\n    \"refcount\": 7,\n    \"calling\": 6,\n    \"address\": 6,\n    \"called\": 3\n  },\n  \"unmatched_funcs_len\": 2,\n  \"total_funcs_len\": 60664,\n  \"matched_funcs_len\": 60662,\n  \"matched_funcs_with_code_changes_len\": 5,\n  \"matched_funcs_with_non_code_changes_len\": 6,\n  \"matched_funcs_no_changes_len\": 60651,\n  \"match_func_similarity_percent\": \"99.9819%\",\n  \"func_match_overall_percent\": \"99.9967%\"\n}\nINFO | ghidriff | Writing md diff...\nINFO | ghidriff | Generating markdown from {'added_funcs_len': 1, 'deleted_funcs_len': 1, 'modified_funcs_len': 11, 'added_symbols_len': 12, 'deleted_symbols_len': 8, 'diff_time': 86.45361375808716, 'deleted_strings_len': 6, 'added_strings_len': 39, 'match_types': Counter({'SymbolsHash': 27893, 'StructuralGraphHash': 693, 'ExactInstructionsFunctionHasher': 123, 'ExactBytesFunctionHasher': 100, 'BulkInstructionHash': 2}), 'items_to_process': 33, 'diff_types': Counter({'refcount': 7, 'calling': 6, 'address': 6, 'code': 5, 'length': 5, 'called': 3}), 'unmatched_funcs_len': 2, 'total_funcs_len': 60664, 'matched_funcs_len': 60662, 'matched_funcs_with_code_changes_len': 5, 'matched_funcs_with_non_code_changes_len': 6, 'matched_funcs_no_changes_len': 60651, 'match_func_similarity_percent': '99.9819%', 'func_match_overall_percent': '99.9967%'}\nINFO | ghidriff | Known Command line: python ghidriff --project-location .ghidra_projects --project-name ghidriff --symbols-path .symbols --threaded --log-level INFO --file-log-level INFO --log-path ghidriff.log --max-ram-percent 60.0 --max-section-funcs 200 ntoskrnl.exe.10.0.22621.1344 ntoskrnl.exe.10.0.22621.1413\nINFO | ghidriff | Extra Command line: --engine VersionTrackingDiff --output-path .ghidriffs\nINFO | ghidriff | Writing pdiff json...\nINFO | ghidriff | Wrote .ghidriffs/ntoskrnl.exe.10.0.22621.1344-ntoskrnl.exe.10.0.22621.1413_diff.md\nINFO | ghidriff | Wrote .ghidriffs/json/ntoskrnl.exe.10.0.22621.1344-ntoskrnl.exe.10.0.22621.1413_diff.json\n"})}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"analyze-the-diff",children:"Analyze the Diff"}),"\n",(0,i.jsxs)(e.p,{children:["Results in this beatiful markdown: ",(0,i.jsx)(e.a,{href:"https://gist.github.com/clearbluejar/b95ae854a92ee917cd0b5c7055b60282",children:"ntoskrnl.exe.10.0.22621.1344-ntoskrnl.exe.10.0.22621.1413.diff.md"})]}),"\n",(0,i.jsxs)(e.p,{children:["See if you can figure out what function was patched for ",(0,i.jsx)(e.a,{href:"https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-23420",children:"CVE-2023-2342"}),"."]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Details of ",(0,i.jsx)(e.a,{href:"https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-23420",children:"CVE-2023-2342"})," can be found here: ",(0,i.jsx)(e.a,{href:"https://bugs.chromium.org/p/project-zero/issues/detail?id=2392",children:"https://bugs.chromium.org/p/project-zero/issues/detail?id=2392"})]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["Prefer a side by side diff? Try out ",(0,i.jsx)(e.code,{children:"ghidriff"}),"'s custom html viewer. ",(0,i.jsx)(e.a,{href:"https://diffpreview.github.io/?b95ae854a92ee917cd0b5c7055b60282",children:"https://diffpreview.github.io/?b95ae854a92ee917cd0b5c7055b60282"})]}),"\n",(0,i.jsxs)(e.h5,{id:"results-stored-in-ghidriffs-folder",children:["Results stored in ",(0,i.jsx)(e.code,{children:"ghidriffs"})," folder"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"$ tree ghidriffs\nghidriffs\n\u251c\u2500\u2500 ghidra_projects\n\u2502   \u2514\u2500\u2500 ghidriff-ntoskrnl.exe.10.0.22621.2215-ntoskrnl.exe.10.0.22621.2283\n\u2502       \u251c\u2500\u2500 ghidriff-ntoskrnl.exe.10.0.22621.2215-ntoskrnl.exe.10.0.22621.2283.gpr\n\u2502       \u2514\u2500\u2500 ghidriff-ntoskrnl.exe.10.0.22621.2215-ntoskrnl.exe.10.0.22621.2283.rep\n\u2502           \u251c\u2500\u2500 idata\n\u2502           \u251c\u2500\u2500 project.prp\n\u2502           \u251c\u2500\u2500 user\n\u2502           \u2514\u2500\u2500 versioned\n\u251c\u2500\u2500 ghidriff.log\n\u251c\u2500\u2500 json\n\u2502   \u2514\u2500\u2500 ntoskrnl.exe.10.0.22621.2215-ntoskrnl.exe.10.0.22621.2283.ghidriff.json\n\u251c\u2500\u2500 ntoskrnl.exe.10.0.22621.2215-ntoskrnl.exe.10.0.22621.2283.ghidriff.md\n\u2514\u2500\u2500 symbols\n    \u251c\u2500\u2500 ntkrnlmp.pdb\n        \u251c\u2500\u2500 69071F680ADFE36F178C6EC06E79E09C1\n        \u2502   \u2514\u2500\u2500 ntkrnlmp.pdb\n        \u2514\u2500\u2500 738ED8FF966E8502EFE17095B9F1F5481\n            \u2514\u2500\u2500 ntkrnlmp.pdb\n"})})]})}function f(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>t,x:()=>a});var i=s(6540);const o={},r=i.createContext(o);function t(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:t(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);